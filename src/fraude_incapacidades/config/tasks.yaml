extract_and_validate_task:
  description: >
    PASO 1 — EXTRACCIÓN Y ANÁLISIS FORENSE DEL DOCUMENTO
    
    Archivo a analizar: {file_path}
    
    A) EXTRACCIÓN FORENSE Y ESTRUCTURADA: Usa la herramienta "Extraccion Forense y Estructuracion PDF" pasándole exactamente la ruta del archivo: {file_path}.
       Esto utilizará un modelo de lenguaje interno para extraer limpiamente los datos del paciente, del médico y la EPS en un formato JSON ordenado, además de darte detalles sobre los logos y metadatos.
       
    B) LECTURA DEL JSON RESULTANTE: Analiza la respuesta de la herramienta. Tomarás este JSON extraído como la ÚNICA fuente de verdad para los pasos de verificación. Ya tienes extraído:
       - Nombre y documento del paciente
       - Nombre y documento/registro del médico
       - Código CIE-10 y diagnóstico
       - EPS mencionada
    
    C) VALIDACIÓN CIE-10: Usa el código extraído en la herramienta "Validacion CIE-10" pasándole un JSON con:
       {"codigo": "CÓDIGO_AQUÍ", "diagnostico_texto": "DIAGNÓSTICO_AQUÍ", "dias_incapacidad": NUMERO}
       
    D) ANÁLISIS DE LA CAPA VISUAL Y METADATOS: Revisa el bloque de `hallazgos_forenses_visuales`:
       - ¿Hay alertas_forenses_automaticas? (¿Creado con Canva/Word/Photoshop? ¿Múltiples fuentes?)
       - Si no se detectaron imágenes (logos), márcalo como ALTAMENTE SOSPECHOSO.

    Señala CADA ANOMALÍA como "⚠️ ALERTA DE RIESGO".
    
  expected_output: >
    Un reporte detallado con los datos estructurados extraídos, el análisis forense visual de logos y metadatos, y el resultado de la coherencia del CIE-10.
  agent: auditor_medico_forense

search_and_verify_task:
  description: >
    PASO 2 — VERIFICACIÓN CRUZADA DE ENTIDADES
    
    Usa los datos estructurados que el agente anterior extrajo para realizar estas validaciones críticas:
    
    A) VALIDACIÓN DE LA EPS: Usa la herramienta "Validacion EPS Colombia" pasándole el nombre de la EPS del documento (ej: "Sura", "Sanitas"). Verificará si es una EPS legal y real del sistema de salud colombiano. Si no lo es o es inventada, esto es un fraude crítico.
    
    B) VERIFICACIÓN RETHUS (MÉDICO): Usa la herramienta "Verificacion RETHUS SISPRO" pasándole un JSON (ej: {"tipo_documento": "CC", "numero_documento": "1234"}). Esto verifica la habilitación del médico en Colombia.
    
    C) VERIFICACIÓN ADRES (PACIENTE): Usa la herramienta "Verificacion ADRES BDUA" con el documento del paciente. Verifica la afiliación al SGSSS.
    
    D) BÚSQUEDA WEB (OSINT): Usa la herramienta "Busqueda Web OSINT" para buscar el nombre de la clínica o médico. Busca reportes de suplantación, venta fraudulenta, o si la clínica realmente existe.
    
    Si falta algún dato clave (ej: no hay EPS), marca una alerta grave.
    
  expected_output: >
    Resultados y confirmación de existencia de la EPS de Colombia, verificación RETHUS del médico, existencia del paciente en ADRES y rastreo web.
  agent: investigador_osint

generate_final_report_task:
  description: >
    PASO 3 — GENERAR INFORME FINAL EN JSON
    
    Consolida TODA la información y genera EXCLUSIVAMENTE un JSON con la estructura EXACTA:
    
    {
      "puntaje_veracidad": <0 a 100>,
      "hallazgos_medicos": "<texto describiendo diagnóstico, datos estructurados del médico (nombre, doc) y paciente, logos extraídos>",
      "analisis_forense": "<texto describiendo formato del documento (software) y alertas>",
      "verificacion_entidades": "<texto de existencia EPS, RETHUS, ADRES y OSINT>",
      "alertas": ["alerta 1", "alerta 2", "..."],
      "veredicto": "<Válida|Sospechosa|Fraudulenta>"
    }
    
    REGLAS ESTRICTAS DE PUNTAJE Y VEREDICTO:
    - Empieza en 100 y resta así:
      - EPS no real o no validada: -30 pts
      - Falta de logos / formato inusual (creado en word/canva): -20 pts
      - Médico NO encontrado en RETHUS: -20 pts
      - Paciente NO afiliado en ADRES: -15 pts
      - CIE-10 incoherente en días: -15 pts
      - Rastro farsa / fachada OSINT: -30 pts
    
    Veredicto: 85-100: Válida | 60-84: Sospechosa | 0-59: Fraudulenta.
    
    (Habeas Data): Anonimiza nombres de paciente.
    IMPORTANTE: RESPONDE SOLO CON EL JSON.
  expected_output: >
    JSON que el frontend leerá. Estricto.
  agent: redactor_dictamen
