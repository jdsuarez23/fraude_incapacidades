extract_text_task:
  description: >
    Extrae TODO el contenido del documento m√©dico cargado desde: {file_path}.
    
    Debes obtener:
    1. El TEXTO COMPLETO visible del documento (nombre del paciente, c√©dula, diagn√≥stico,
       c√≥digos CIE-10, fechas, nombre del m√©dico, n√∫mero de registro m√©dico, NIT de EPS/IPS,
       n√∫mero del certificado, modalidad de prestaci√≥n, duraci√≥n en d√≠as, ciudad).
    2. Los METADATOS T√âCNICOS del archivo PDF (software productor, fecha de creaci√≥n,
       fecha de √∫ltima modificaci√≥n, versi√≥n del PDF, autor, n√∫mero de p√°ginas).
    3. La CANTIDAD DE IM√ÅGENES u objetos embebidos en el documento.
    
    ALERTA FORENSE: Si el campo "producer" o "creator" de los metadatos contiene
    herramientas como 'iLovePDF', 'Smallpdf', 'PDFescape', 'Sejda', 'PDF24', 'Adobe Acrobat',
    o cualquier herramienta de edici√≥n de terceros, REPORTARLO COMO SE√ëAL CR√çTICA DE ALERTA.
    Los sistemas corporativos de EPS (SURA, Compensar, Nueva EPS, etc.) generan PDFs con
    software empresarial propio, nunca con herramientas web gratuitas.
  expected_output: >
    Un reporte con:
    - Texto completo extra√≠do del documento.
    - Metadatos t√©cnicos detallados del archivo.
    - Lista de objetos embebidos (im√°genes, capas).
    - Alerta inicial si se detect√≥ software de edici√≥n de terceros.
  agent: ocr_agent

analyze_structure_task:
  description: >
    Bas√°ndote en el texto extra√≠do en la tarea anterior, eval√∫a la estructura formal
    del documento como certificado de incapacidad m√©dica en Colombia:
    
    1. VERIFICACI√ìN DE ENTIDADES:
       - ¬øEl NIT de la EPS es v√°lido y activo? (Ej: EPS SURA = 800088702, Compensar = 800025221)
       - ¬øEl NIT de la IPS que atiende es un prestador registrado en REPS (Registro Especial de
         Prestadores de Salud)?
       - ¬øEl nombre de la IPS corresponde al NIT declarado?
    
    2. CAMPOS OBLIGATORIOS seg√∫n normativa colombiana:
       - N√∫mero del certificado de incapacidad
       - Fecha completa de expedici√≥n (d√≠a, mes, a√±o, hora)
       - Clasificaci√≥n del origen (Enfermedad General / Accidente de Trabajo / Enfermedad Profesional)
       - Tipo de prestaci√≥n (Ambulatorio / Hospitalario)
       - Clasificaci√≥n (Inicial / Pr√≥rroga)
       - Modalidad (Intramural / Extramural / Telemedicina)
       - Si es retroactiva (S√≠/No)
    
    3. COHERENCIA DE FECHAS: ¬øLas fechas de inicio y fin son l√≥gicas? ¬øSon posteriores a la
       fecha de expedici√≥n? ¬øEs un fin de semana o festivo (potencial se√±al de fraude)?
    
    Se√±ala CADA inconsistencia como una "ALERTA DE RIESGO" con nivel: CR√çTICO / ALTO / MEDIO / BAJO.
  expected_output: >
    Evaluaci√≥n detallada de la estructura del documento con lista de alertas de riesgo priorizadas
    y validaci√≥n de campos obligatorios seg√∫n la normativa SGSSS colombiana.
  agent: document_structure_agent

validate_medical_data_task:
  description: >
    Realiza la validaci√≥n m√©dico-legal profunda del contenido del certificado:
    
    1. VALIDACI√ìN CIE-10:
       - Verifica que el c√≥digo diagn√≥stico exista en la clasificaci√≥n CIE-10.
       - Determina si la duraci√≥n de la incapacidad (n√∫mero de d√≠as) es COHERENTE con el
         protocolo de manejo del diagn√≥stico seg√∫n la gu√≠a de la DSSA y est√°ndares m√©dicos.
       - DIAGN√ìSTICOS DE ALTO RIESGO DE FRAUDE (se√±alar si aplica):
         A09 (Diarrea no especificada), A083 (Gastroenteritis viral), J00 (Rinofaringitis),
         J06.9 (IRAS no especificada), M54.5 (Lumbalgia), K30 (Dispepsia),
         R51 (Cefalea), R50.9 (Fiebre no especificada).
       - ¬øEs un diagn√≥stico que IMPOSIBILITA trabajar el n√∫mero de d√≠as declarado?
    
    2. VERIFICACI√ìN DEL PROFESIONAL (RETHUS):
       - El n√∫mero de c√©dula del m√©dico debe coincidir con su n√∫mero de registro m√©dico.
       - ¬øEl m√©dico es de la especialidad adecuada para el diagn√≥stico declarado?
       - ¬øEs sospechoso que la atenci√≥n sea virtual (telemedicina) para ese diagn√≥stico?
    
    3. VERIFICACI√ìN DEL PACIENTE:
       - ¬øEl tipo y n√∫mero de documento del paciente tienen formato colombiano v√°lido?
         (CC: 7-10 d√≠gitos, TI: 10-11 d√≠gitos, CE: 6-10 d√≠gitos)
       - ¬øLa IPS de afiliaci√≥n del paciente es coherente con su ciudad declarada?
    
    4. COHERENCIA L√ìGICA:
       - ¬øEl diagn√≥stico es compatible con la modalidad de prestaci√≥n (ambulatorio vs hospitalario)?
       - Para diagn√≥sticos leves (Ej: A083 gastroenteritis), ¬øes sospechoso m√°s de 3 d√≠as?
  expected_output: >
    Validaci√≥n completa con: diagn√≥stico CIE-10 verificado, coherencia de d√≠as de incapacidad,
    estado del m√©dico en RETHUS, banderas rojas de identidad y coherencia l√≥gica del cuadro cl√≠nico.
  agent: medical_data_verifier

detect_fraud_task:
  description: >
    Integra TODOS los hallazgos anteriores para determinar el nivel de sospecha de fraude.
    
    Eval√∫a las siguientes dimensiones de riesgo:
    
    DIMENSI√ìN 1 ‚Äî FORENSE DIGITAL (peso: 40%)
    - ¬øSe detect√≥ software de edici√≥n no corporativo en metadatos? (iLovePDF, etc.) ‚Üí CR√çTICO
    - ¬øLa fecha de modificaci√≥n del PDF es posterior a la fecha de expedici√≥n en el documento?
    - ¬øHay capas u objetos superpuestos que sugieran parcheado de texto?
    
    DIMENSI√ìN 2 ‚Äî ENTIDADES E INSTITUCIONES (peso: 25%)
    - ¬øEl NIT de EPS/IPS es v√°lido y activo en el REPS?
    - ¬øHay inconsistencia entre el logo o nombre mencionado y el NIT?
    
    DIMENSI√ìN 3 ‚Äî DATOS M√âDICOS Y CL√çNICOS (peso: 20%)
    - ¬øEl diagn√≥stico CIE-10 es exacto y la duraci√≥n es razonable?
    - ¬øEs un diagn√≥stico de "lista de alto fraude"?
    - ¬øEl profesional tiene habilitaci√≥n para el tipo de atenci√≥n?
    
    DIMENSI√ìN 4 ‚Äî IDENTIDAD DEL PACIENTE (peso: 15%)
    - ¬øEl formato de c√©dula/TI es v√°lido para Colombia?
    - ¬øHay inconsistencias en nombre o IPS de afiliaci√≥n?
    
    Calcula un PUNTAJE DE RIESGO DE FRAUDE de 0 a 100:
    0-20 = Bajo riesgo (Probablemente aut√©ntico)
    21-50 = Moderado (Investigar antes de pagar)
    51-80 = Alto (Rechazar provisionalmente, pedir verificaci√≥n directa con EPS)
    81-100 = Cr√≠tico (Evidencia fuerte de fraude ‚Äî iniciar proceso disciplinario)
  expected_output: >
    Puntaje de riesgo de fraude con desglose por dimensi√≥n, lista de se√±ales de alerta
    identificadas, nivel de confianza del an√°lisis y clasificaci√≥n del caso.
  agent: fraud_detection_agent

generate_report_task:
  description: >
    Redacta el INFORME FINAL DE VALIDACI√ìN FORENSE DE INCAPACIDAD M√âDICA.
    Usa EXACTAMENTE este formato:
    
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    üìã INFORME DE VALIDACI√ìN FORENSE ‚Äî INCAPACIDAD M√âDICA
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    ‚öñÔ∏è PUNTAJE DE VERACIDAD: XX% | üî¥/üü°/üü¢ VEREDICTO: [V√ÅLIDA / SOSPECHOSA / FRAUDULENTA]
    
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    1. DATOS B√ÅSICOS DEL DOCUMENTO
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    ‚Ä¢ Paciente:        [Nombre + C√©dula]
    ‚Ä¢ EPS:             [Nombre + NIT]
    ‚Ä¢ IPS que atiende: [Nombre + NIT]
    ‚Ä¢ M√©dico:          [Nombre + Registro M√©dico]
    ‚Ä¢ No. Certificado: [N√∫mero]
    ‚Ä¢ Fecha expedici√≥n:[Fecha completa]
    ‚Ä¢ Diagn√≥stico:     [C√≥digo CIE-10 + Descripci√≥n]
    ‚Ä¢ D√≠as:            [N d√≠as ‚Äî Desde [Fecha] hasta [Fecha]]
    ‚Ä¢ Modalidad:       [Ambulatorio/Hospitalario ‚Äî Intramural/Telemedicina]
    
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    2. HALLAZGOS FORENSES DIGITALES
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    [Listar hallazgos del an√°lisis de metadatos y estructura del archivo]
    
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    3. VALIDACI√ìN M√âDICA CIE-10
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    [An√°lisis de coherencia diagn√≥stico-d√≠as-modalidad]
    
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    4. VERIFICACI√ìN DE ENTIDADES Y PROFESIONAL
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    [Estado de EPS, IPS y m√©dico en registros oficiales]
    
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    5. ALERTAS DE RIESGO
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    üî¥ CR√çTICO:  [Alertas cr√≠ticas]
    üü† ALTO:     [Alertas altas]
    üü° MEDIO:    [Alertas medias]
    üü¢ BAJO:     [Alertas bajas o ninguna]
    
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    6. VEREDICTO FINAL Y RECOMENDACIONES
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    Veredicto: [V√ÅLIDA ‚úÖ / SOSPECHOSA ‚ö†Ô∏è / FRAUDULENTA ‚ùå]
    
    Acciones recomendadas:
    ‚Ä¢ [Acci√≥n 1]
    ‚Ä¢ [Acci√≥n 2]
    ‚Ä¢ [Acci√≥n 3]
    
    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    ‚ö†Ô∏è Nota: Este informe es generado por IA y debe ser
    revisado por un profesional de RRHH o jur√≠dico antes
    de tomar decisiones legales. Aplica Ley 1581/2012
    (Habeas Data).
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  expected_output: >
    Informe final completo con el formato exacto especificado, incluyendo puntaje de
    veracidad, veredicto, todos los hallazgos organizados por categor√≠a, alertas
    de riesgo priorizadas y recomendaciones de acci√≥n.
  agent: report_generator_agent
